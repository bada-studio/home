<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Dashboard</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/dashboard.css" rel="stylesheet">

    <link as=style href=js/chart/css/app.339a5c38.css rel=preload>
    <link as=style href=js/chart/css/chunk-vendors.a2442821.css rel=preload>
    <link href=js/chart/css/app.339a5c38.css rel=stylesheet>
    <link href=js/chart/css/chunk-vendors.a2442821.css rel=stylesheet>
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
  </head>

  <body>

    <header>
      <!-- Fixed navbar -->
      <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <a class="navbar-brand" href="#">Dashboard</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
              <a class="nav-link" href="#">Balance</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="expenses.html">Expense</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="dividend.html">Dividend</a>
            </li>
          </ul>
        </div>
      </nav>
    </header>

    <!-- Begin page content -->
    <main role="main" class="container" id="app">
      <h1 class="balance mt-5">{{ balance.balance }}</h1>
      <p>컨트랙트 계좌에 유지하고 있는 EOS 잔액입니다.</p>

      <h1 class="mt-5">Assets</h1>

      <div>
        <h6>Player Count</h6>
        <p>게임에 가입한 유저 수</p>
        <p class="balance">{{ adminstate.player_count }}<p>

        <p>현재 접속자 수</p>
        <p class="balance">{{ connectionUserCount }}<p>

        <h6>Revenue</h6>
        <p>운영 수익입니다. 분배하거나, 지출시 줄어듭니다.</p>
        <p class="balance">{{ adminstate.revenue }}<p>

        <h6>Invenstment</h6>
        <p>투자 내역입니다.</p>
        <p class="balance">{{ adminstate.investment }}<p>

        <h6>Expenses</h6>
        <p>운영시 지출한 내역입니다. 출금시 자동 기록됩니다.</p>
        <p class="balance">{{ adminstate.expenses }}<p>

        <h6>Dividend</h6>
        <p>운영 수익중 주주에게 분배한 액수입니다.</p>
        <p class="balance">{{ adminstate.dividend }}<p>

      </div>

    </main>

    <div class="container" id="app">
      <h6>Revenue</h6>
      <div class="chart-container">
        <canvas id="shapshotChart" width="400" height="200"></canvas>
      </div>
      <br/>
      <h6>Delta</h6>
      <div class="chart-container">
        <canvas id="deltaChart" width="400" height="200"></canvas>
      </div>
      </br>
      <h6>Account Delta</h6>
      <div class="chart-container">
        <canvas id="accountDeltaChart" width="400" height="200"></canvas>
      </div>

    </div>

    <script>
    $.ajax({
      url: "https://api.eosknights.io/api/v1/revenue/revenues/hourly-snapshots",
      type: "post",
      data: JSON.stringify({from:0, size:1000}),
      contentType: "application/json"
    }).done(function(data) {
      var logs = [];

      for (i = 0; i < data.length; i++) { 
        if (logs.length == 0 || logs[logs.length-1].created != data[i].created) {
          logs.push({
            created: data[i].created,
            itemIventoryUp: parseFloat(data[i].itemIventoryUp),
            itemTax: parseFloat(data[i].itemTax),
            knight: parseFloat(data[i].knight),
            matIventoryUp: parseFloat(data[i].matIventoryUp),
            materialTax: parseFloat(data[i].materialTax),
            mp: parseFloat(data[i].mp),
            userCount: parseInt(data[i].userCount)
          });
        } else {
          logs[logs.length-1].itemIventoryUp = parseFloat(data[i].itemIventoryUp);
          logs[logs.length-1].itemTax = parseFloat(data[i].itemTax);
          logs[logs.length-1].knight = parseFloat(data[i].knight);
          logs[logs.length-1].matIventoryUp = parseFloat(data[i].matIventoryUp);
          logs[logs.length-1].materialTax = parseFloat(data[i].materialTax);
          logs[logs.length-1].mp = parseFloat(data[i].mp);
          logs[logs.length-1].userCount = parseInt(data[i].userCount);
        }
      }
      
      var itemIventoryUp = [];
      var itemTax = [];
      var knight = [];
      var matIventoryUp = [];
      var materialTax = [];
      var mp = [];
      var labels = [];
      var userCount = [];

      for (i = 0; i < logs.length; i++) { 
        labels.push(logs[i].created.substring(5));
        itemIventoryUp.push(parseInt(logs[i].itemIventoryUp));
        itemTax.push(parseInt(logs[i].itemTax));
        knight.push(parseInt(logs[i].knight));
        matIventoryUp.push(parseInt(logs[i].matIventoryUp));
        materialTax.push(parseInt(logs[i].materialTax));
        mp.push(parseInt(logs[i].mp));
        userCount.push(parseInt(logs[i].userCount));
      }

      var ctx = document.getElementById("shapshotChart");
      var shapshotChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Magic Water',
            data: mp,
            backgroundColor: 'rgba(255, 99, 132, 0.2)',
            borderColor: 'rgba(255,99,132,1)',
            borderWidth: 1
          }, {
            label: 'Knight',
            data: knight,
            backgroundColor: 'rgba(54, 162, 235, 0.2)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
          }, {
            label: 'ItemTax',
            data: itemTax,
            backgroundColor: 'rgba(255, 206, 86, 0.2)',
            borderColor: 'rgba(255, 206, 86, 1)',
            borderWidth: 1
          }, {
            label: 'MaterialTax',
            data: materialTax,
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            borderColor: 'rgba(75, 192, 192, 1)',
            borderWidth: 1
          }, {
            label: 'ItemIventoryUp',
            data: itemIventoryUp,
            backgroundColor: 'rgba(153, 102, 255, 0.2)',
            borderColor: 'rgba(153, 102, 255, 1)',
            borderWidth: 1
          }, {
            label: 'MaterialIventoryUp',
            data: matIventoryUp,
            backgroundColor: 'rgba(255, 159, 64, 0.2)',
            borderColor: 'rgba(255, 159, 64, 1)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          scales: {
            yAxes: [{
              ticks: {
                beginAtZero:true
              }
            }]
          }
        }
      });
    });


    $.ajax({
      url: "https://api.eosknights.io/api/v1/revenue/revenues/hourly-variations",
      type: "post",
      data: JSON.stringify({from:0, size:1000}),
      contentType: "application/json"
    }).done(function(data) {
      var logs = [];

      for (i = 0; i < data.length; i++) { 
        if (logs.length == 0 || logs[logs.length-1].created != data[i].created) {
          logs.push({
            created: data[i].created,
            itemIventoryUp: parseFloat(data[i].itemIventoryUp),
            itemTax: parseFloat(data[i].itemTax),
            knight: parseFloat(data[i].knight),
            matIventoryUp: parseFloat(data[i].matIventoryUp),
            materialTax: parseFloat(data[i].materialTax),
            mp: parseFloat(data[i].mp),
            userCount: parseInt(data[i].userCount)
          });
        } else {
          logs[logs.length-1].itemIventoryUp += parseFloat(data[i].itemIventoryUp);
          logs[logs.length-1].itemTax += parseFloat(data[i].itemTax);
          logs[logs.length-1].knight += parseFloat(data[i].knight);
          logs[logs.length-1].matIventoryUp += parseFloat(data[i].matIventoryUp);
          logs[logs.length-1].materialTax += parseFloat(data[i].materialTax);
          logs[logs.length-1].mp += parseFloat(data[i].mp);
          logs[logs.length-1].userCount += parseInt(data[i].userCount);
        }
      }
      
      var itemIventoryUp = [];
      var itemTax = [];
      var knight = [];
      var matIventoryUp = [];
      var materialTax = [];
      var mp = [];
      var labels = [];
      var userCount = [];

      for (i = 0; i < logs.length; i++) { 
        labels.push(logs[i].created.substring(5));
        itemIventoryUp.push(parseInt(logs[i].itemIventoryUp));
        itemTax.push(parseInt(logs[i].itemTax));
        knight.push(parseInt(logs[i].knight));
        matIventoryUp.push(parseInt(logs[i].matIventoryUp));
        materialTax.push(parseInt(logs[i].materialTax));
        mp.push(parseInt(logs[i].mp));
        userCount.push(parseInt(logs[i].userCount));
      }

      var ctx = document.getElementById("deltaChart");
      var deltaChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Magic Water',
            data: mp,
            backgroundColor: 'rgba(255, 99, 132, 1)',
            borderColor: 'rgba(255,99,132,1)',
            borderWidth: 1
          }, {
            label: 'Knight',
            data: knight,
            backgroundColor: 'rgba(54, 162, 235, 1)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
          }, {
            label: 'ItemTax',
            data: itemTax,
            backgroundColor: 'rgba(255, 206, 86, 1)',
            borderColor: 'rgba(255, 206, 86, 1)',
            borderWidth: 1
          }, {
            label: 'MaterialTax',
            data: materialTax,
            backgroundColor: 'rgba(75, 192, 192, 1)',
            borderColor: 'rgba(75, 192, 192, 1)',
            borderWidth: 1
          }, {
            label: 'ItemIventoryUp',
            data: itemIventoryUp,
            backgroundColor: 'rgba(153, 102, 255, 1)',
            borderColor: 'rgba(153, 102, 255, 1)',
            borderWidth: 1
          }, {
            label: 'MaterialIventoryUp',
            data: matIventoryUp,
            backgroundColor: 'rgba(255, 159, 64, 1)',
            borderColor: 'rgba(255, 159, 64, 1)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          scales: {
            yAxes: [{
              stacked: true,
              ticks: {
                beginAtZero:true
              }
            }]
          }
        }
      });

      var ctx2 = document.getElementById("accountDeltaChart");
      var accountDeltaChart = new Chart(ctx2, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Account Count',
            data: userCount,
            backgroundColor: 'rgba(255, 99, 132, 1)',
            borderColor: 'rgba(255,99,132,1)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          scales: {
            yAxes: [{
              ticks: {
                beginAtZero:true
              }
            }]
          }
        }
      });
    });


    </script>    

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <script src="vendor/vue/vue.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="vendor/axios/axios.min.js"></script>
    <script src="js/dashboard.js"></script>


    
  </body>
</html>
